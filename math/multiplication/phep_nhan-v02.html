<!doctype html>
<html lang="vi">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B·∫£ng c·ª≠u ch∆∞∆°ng: Nh√¢n / Chia</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>H·ªçc b·∫£ng c·ª≠u ch∆∞∆°ng (x1 ‚Üí x10)</h1>
      <div class="sub">
        Ch·ªçn <b>ph√©p nh√¢n</b> ho·∫∑c <b>ph√©p chia</b>. Ch·ªçn b·∫£ng t·ª´ <b>2 ‚Üí 9</b> ho·∫∑c b·∫≠t <b>t·ª± ƒë·ªông</b>.
        M·ªói phi√™n s·∫Ω c√≥ <b>10 c√¢u</b>. N·∫øu tr·∫£ l·ªùi sai, s·∫Ω <b>kh√¥ng chuy·ªÉn sang ph√©p t√≠nh m·ªõi</b>.
      </div>

      <div class="controls" role="group" aria-label="C·∫•u h√¨nh">
        <label>
          <input id="opMul" type="checkbox" checked />
          Ph√©p nh√¢n
        </label>
        <label>
          <input id="opDiv" type="checkbox" />
          Ph√©p chia
        </label>

        <label>
          B·∫£ng:
          <select id="tableSelect" aria-label="Ch·ªçn b·∫£ng">
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
        </label>

        <label>
          <input id="autoTable" type="checkbox" />
          T·ª± ƒë·ªông ch·ªçn b·∫£ng (2 ‚Üí 9)
        </label>
      </div>

      <div class="btns">
        <button id="btnStart" class="primary">B·∫Øt ƒë·∫ßu / L√†m l·∫°i</button>
        <button id="btnClearLog" class="secondary" title="Xo√° b·∫£ng k·∫øt qu·∫£">Xo√° k·∫øt qu·∫£</button>
      </div>

      <div class="quiz">
        <!-- ‚úÖ Input n·∫±m ngay v·ªã tr√≠ "?" -->
        <div class="qblock" aria-live="polite">
          <div class="qexpr">
            <span id="qA">‚Äî</span>
            <span id="qOp">√ó</span>
            <span id="qB">‚Äî</span>
            <span>=</span>

            <span class="ansBox" title="ƒêi·ªÅn ƒë√°p √°n">
              <input id="answer" class="answerInBox" type="number" inputmode="numeric" pattern="[0-9]*" placeholder=""
                autocomplete="off" />
            </span>
          </div>
        </div>

        <div id="status" class="status warn">Nh·∫•n <b>B·∫Øt ƒë·∫ßu</b> ƒë·ªÉ t·∫°o c√¢u h·ªèi.</div>

        <div class="btns">
          <button id="btnSubmit" class="primary" disabled>N·ªôp b√†i</button>
          <button id="btnNext" class="secondary" disabled>C√¢u ti·∫øp theo</button>
        </div>

        <div class="stats">
          <div class="pill">C√¢u: <b id="statQ">0/10</b></div>
          <div class="pill">ƒê√∫ng: <b id="statCorrect">0</b></div>
          <div class="pill">Sai: <b id="statWrong">0</b></div>
          <div class="pill">T·ª∑ l·ªá ƒë√∫ng: <b id="statAcc">0%</b></div>
        </div>

        <div class="hint">M·∫πo: B·∫•m <b>Enter</b> ƒë·ªÉ n·ªôp b√†i.</div>
      </div>
    </div>

    <div class="row">
      <div class="card">
        <h1>B·∫£ng k·∫øt qu·∫£ (m·ªói l·∫ßn n·ªôp b√†i)</h1>
        <div class="sub">M·ªói l·∫ßn b√© b·∫•m ‚ÄúN·ªôp b√†i‚Äù, h·ªá th·ªëng ghi l·∫°i <b>th·ªùi gian ho√†n th√†nh</b>, <b>ƒë√∫ng/sai</b> v√†
          <b>t·ª∑ l·ªá ƒë√∫ng</b>.</div>
        <div class="hr"></div>

        <div class="logWrap" aria-label="K·∫øt qu·∫£ (cu·ªôn ƒë·ªÉ xem th√™m)">
          <table>
            <thead>
              <tr>
                <th style="width:60px;">#</th>
                <th>Ph√©p t√≠nh</th>
                <th style="width:120px;">B√© tr·∫£ l·ªùi</th>
                <th style="width:110px;">K·∫øt qu·∫£</th>
                <th style="width:120px;">Th·ªùi gian</th>
                <th style="width:120px;">T·ª∑ l·ªá ƒë√∫ng</th>
              </tr>
            </thead>
            <tbody id="logBody">
              <tr>
                <td colspan="6" class="small">Ch∆∞a c√≥ d·ªØ li·ªáu.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="hint">Hi·ªÉn th·ªã m·∫∑c ƒë·ªãnh ~5 k·∫øt qu·∫£ g·∫ßn nh·∫•t. Cu·ªôn trong khung n√†y ƒë·ªÉ xem c√°c k·∫øt qu·∫£ c≈© h∆°n.</div>
      </div>

      <div class="card">
        <h1>Quy t·∫Øc t·∫°o c√¢u h·ªèi</h1>
        <div class="sub" style="margin-top:8px;">
          <div style="margin:6px 0;">
            <span class="tag">Ph√©p nh√¢n</span>
            A = b·∫£ng (2‚Üí9 ho·∫∑c t·ª± ƒë·ªông), B = ng·∫´u nhi√™n (1‚Üí10), c√¢u: <b>A √ó B = ?</b>
          </div>
          <div style="margin:6px 0;">
            <span class="tag">Ph√©p chia</span>
            L·∫•y t·ª´ ph√©p nh√¢n: t√≠ch = A√óB. Khi h·ªèi chia: <b>(A√óB) / A = ?</b> (A l√† b·∫£ng 2‚Üí9).
          </div>
          <div class="hr"></div>
          <div class="small">
            N·∫øu tr·∫£ l·ªùi sai: v·∫´n gi·ªØ nguy√™n c√¢u h·ªèi ƒë·ªÉ b√© s·ª≠a l·∫°i, <b>kh√¥ng chuy·ªÉn c√¢u m·ªõi</b>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (id) => document.getElementById(id);

    function randInt(min, max) { // inclusive
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function clampOps() {
      const mul = $("opMul").checked;
      const div = $("opDiv").checked;
      if (!mul && !div) $("opMul").checked = true;
    }

    function pickOperation() {
      const mul = $("opMul").checked;
      const div = $("opDiv").checked;
      if (mul && div) return (Math.random() < 0.5) ? "mul" : "div";
      if (mul) return "mul";
      return "div";
    }

    function pickTable() {
      if ($("autoTable").checked) return randInt(2, 9);
      return parseInt($("tableSelect").value, 10);
    }

    function fmtSecs(ms) {
      const s = ms / 1000;
      if (s < 10) return s.toFixed(2) + "s";
      if (s < 60) return s.toFixed(1) + "s";
      const m = Math.floor(s / 60);
      const r = (s - m * 60).toFixed(1);
      return `${m}m ${r}s`;
    }

    // ===== State =====
    let totalQuestions = 10;
    let currentIndex = 0;
    let current = null;
    let questionStart = 0;

    let attempts = 0;
    let correctAttempts = 0;
    let wrongAttempts = 0;

    let logRows = [];

    // ===== UI =====
    function setStatus(text, kind) {
      const el = $("status");
      el.classList.remove("ok", "bad", "warn");
      el.classList.add(kind);
      el.innerHTML = text;
    }

    function renderStats() {
      $("statQ").textContent = `${currentIndex}/${totalQuestions}`;
      $("statCorrect").textContent = String(correctAttempts);
      $("statWrong").textContent = String(wrongAttempts);
      const acc = attempts ? Math.round((correctAttempts / attempts) * 100) : 0;
      $("statAcc").textContent = `${acc}%`;
      return acc;
    }

    function renderLog() {
      const body = $("logBody");
      body.innerHTML = "";

      if (logRows.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 6;
        td.className = "small";
        td.textContent = "Ch∆∞a c√≥ d·ªØ li·ªáu.";
        tr.appendChild(td);
        body.appendChild(tr);
        return;
      }

      for (const row of logRows) {
        const tr = document.createElement("tr");

        const tdN = document.createElement("td");
        tdN.textContent = row.n;
        tr.appendChild(tdN);

        const tdExpr = document.createElement("td");
        tdExpr.textContent = row.expr;
        tr.appendChild(tdExpr);

        const tdAns = document.createElement("td");
        tdAns.textContent = row.answer;
        tr.appendChild(tdAns);

        const tdOk = document.createElement("td");
        const tag = document.createElement("span");
        tag.className = "tag " + (row.ok ? "ok" : "bad");
        tag.textContent = row.ok ? "ƒê√∫ng" : "Sai";
        tdOk.appendChild(tag);
        tr.appendChild(tdOk);

        const tdTime = document.createElement("td");
        tdTime.textContent = row.time;
        tr.appendChild(tdTime);

        const tdAcc = document.createElement("td");
        tdAcc.textContent = row.acc;
        tr.appendChild(tdAcc);

        body.appendChild(tr);
      }
    }

    function updateQuestionUI() {
      if (!current) {
        $("qA").textContent = "‚Äî";
        $("qB").textContent = "‚Äî";
        $("qOp").textContent = "√ó";
        $("answer").value = "";
        $("btnSubmit").disabled = true;
        $("btnNext").disabled = true;
        return;
      }

      $("qA").textContent = String(current.a);
      $("qB").textContent = String(current.b);
      $("qOp").textContent = (current.op === "mul") ? "√ó" : "√∑";
      $("answer").value = "";
      $("answer").focus();

      $("btnSubmit").disabled = false;
      $("btnNext").disabled = true;
    }

    function makeQuestion() {
      clampOps();
      const op = pickOperation();
      const table = pickTable();

      if (op === "mul") {
        const a = table;
        const b = randInt(1, 10);
        const correct = a * b;
        return {
          op, table,
          a, b,
          correct,
          exprText: `${a} √ó ${b} = ?`
        };
      } else {
        const divisor = table;
        const x = randInt(1, 10);
        const dividend = divisor * x;
        return {
          op, table,
          a: dividend,
          b: divisor,
          correct: x,
          exprText: `${dividend} √∑ ${divisor} = ?`
        };
      }
    }

    function startSession() {
      clampOps();

      currentIndex = 0;
      attempts = 0;
      correctAttempts = 0;
      wrongAttempts = 0;

      logRows = [];
      renderLog();
      renderStats();

      nextQuestion(true);
    }

    function nextQuestion(isFirst = false) {
      if (currentIndex >= totalQuestions && !isFirst) {
        setStatus(
          `Ho√†n th√†nh ${totalQuestions} c√¢u üéâ<br><span class="small">B·∫°n c√≥ th·ªÉ b·∫•m ‚ÄúB·∫Øt ƒë·∫ßu / L√†m l·∫°i‚Äù ƒë·ªÉ l√†m phi√™n m·ªõi.</span>`,
          "ok"
        );
        current = null;
        updateQuestionUI();
        $("btnSubmit").disabled = true;
        $("btnNext").disabled = true;
        return;
      }

      currentIndex = isFirst ? 1 : (currentIndex + 1);
      current = makeQuestion();
      questionStart = performance.now();
      updateQuestionUI();

      const opName = (current.op === "mul") ? "ph√©p nh√¢n" : "ph√©p chia";
      setStatus(
        `C√¢u ${currentIndex}/${totalQuestions}: <b>${current.exprText}</b><br><span class="small">ƒêang luy·ªán ${opName}. (B·∫£ng: ${current.table})</span>`,
        "warn"
      );
      renderStats();
    }

    function submitAnswer() {
      if (!current) return;

      const raw = $("answer").value.trim();
      const userVal = raw === "" ? NaN : Number(raw);
      const elapsed = performance.now() - questionStart;

      attempts += 1;

      const ok = Number.isFinite(userVal) && (userVal === current.correct);

      if (ok) {
        correctAttempts += 1;
        setStatus(
          `‚úÖ ƒê√∫ng r·ªìi! <b>${current.exprText}</b> (ƒê√°p √°n: <b>${current.correct}</b>)<br><span class="small">ƒêang chuy·ªÉn sang c√¢u ti·∫øp theo‚Ä¶</span>`,
          "ok"
        );

        const acc = renderStats();

        logRows.unshift({
          n: logRows.length + 1,
          expr: current.exprText.replace("?", "‚ñ°"),
          answer: raw,
          ok: true,
          time: fmtSecs(elapsed),
          acc: `${acc}%`
        });
        renderLog();

        setTimeout(() => nextQuestion(false), 600);

      } else {
        wrongAttempts += 1;
        setStatus(
          `‚ùå Ch∆∞a ƒë√∫ng. H√£y th·ª≠ l·∫°i nh√©!<br><span class="small">Gi·ªØ nguy√™n c√¢u h·ªèi hi·ªán t·∫°i.</span>`,
          "bad"
        );

        const acc = renderStats();

        logRows.unshift({
          n: logRows.length + 1,
          expr: current.exprText.replace("?", "‚ñ°"),
          answer: raw === "" ? "(tr·ªëng)" : raw,
          ok: false,
          time: fmtSecs(elapsed),
          acc: `${acc}%`
        });
        renderLog();

        $("answer").value = "";
        $("answer").focus();
      }
    }

    function clearLog() {
      logRows = [];
      renderLog();
    }

    // ===== Events =====
    $("opMul").addEventListener("change", clampOps);
    $("opDiv").addEventListener("change", clampOps);

    $("btnStart").addEventListener("click", startSession);
    $("btnSubmit").addEventListener("click", submitAnswer);
    $("btnNext").addEventListener("click", () => nextQuestion(false));
    $("btnClearLog").addEventListener("click", clearLog);

    $("answer").addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !$("btnSubmit").disabled) {
        e.preventDefault();
        submitAnswer();
      }
    });
  </script>
</body>

</html>